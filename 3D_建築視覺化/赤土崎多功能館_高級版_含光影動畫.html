<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èµ¤åœŸå´å¤šåŠŸèƒ½é¤¨ - 3Då»ºç¯‰å®Œæ•´å¯è¦–åŒ– [é«˜ç´šç‰ˆ]</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'PingFang SC', sans-serif;
            background: #000;
            overflow: hidden;
            height: 100vh;
        }

        #canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        /* å·¦å´é¢æ¿ - å»ºç¯‰è¦æ ¼ */
        #left-panel {
            position: absolute;
            left: 20px;
            top: 20px;
            width: 380px;
            max-height: 90vh;
            background: rgba(10, 20, 40, 0.95);
            border: 2px solid #00ff88;
            border-radius: 12px;
            padding: 20px;
            overflow-y: auto;
            z-index: 100;
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.3), inset 0 0 20px rgba(0, 255, 136, 0.1);
            scrollbar-width: thin;
            scrollbar-color: #00ff88 rgba(0, 255, 136, 0.1);
        }

        #left-panel::-webkit-scrollbar {
            width: 8px;
        }

        #left-panel::-webkit-scrollbar-track {
            background: rgba(0, 255, 136, 0.1);
        }

        #left-panel::-webkit-scrollbar-thumb {
            background: #00ff88;
            border-radius: 4px;
        }

        .panel-title {
            font-size: 24px;
            color: #00ff88;
            margin-bottom: 15px;
            text-shadow: 0 0 10px #00ff88;
            border-bottom: 2px solid #00ff88;
            padding-bottom: 10px;
        }

        .section {
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 14px;
            color: #00ff88;
            text-transform: uppercase;
            margin-bottom: 10px;
            font-weight: bold;
            letter-spacing: 1px;
        }

        .spec-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(0, 255, 136, 0.2);
            font-size: 12px;
            color: #ccc;
        }

        .spec-label {
            color: #888;
        }

        .spec-value {
            color: #00ff88;
            font-weight: bold;
        }

        /* å³å´é¢æ¿ - æ¨“å±¤è©³æƒ… */
        #right-panel {
            position: absolute;
            right: 20px;
            top: 20px;
            width: 380px;
            max-height: 90vh;
            background: rgba(10, 20, 40, 0.95);
            border: 2px solid #ff00ff;
            border-radius: 12px;
            padding: 20px;
            overflow-y: auto;
            z-index: 100;
            box-shadow: 0 0 30px rgba(255, 0, 255, 0.3), inset 0 0 20px rgba(255, 0, 255, 0.1);
        }

        #right-panel::-webkit-scrollbar {
            width: 8px;
        }

        #right-panel::-webkit-scrollbar-track {
            background: rgba(255, 0, 255, 0.1);
        }

        #right-panel::-webkit-scrollbar-thumb {
            background: #ff00ff;
            border-radius: 4px;
        }

        .floor-detail-title {
            font-size: 18px;
            color: #ff00ff;
            margin-bottom: 12px;
            text-shadow: 0 0 10px #ff00ff;
            border-bottom: 2px solid #ff00ff;
            padding-bottom: 8px;
        }

        .floor-detail-desc {
            font-size: 12px;
            color: #aaa;
            line-height: 1.8;
            margin-bottom: 12px;
        }

        /* åº•éƒ¨æ™‚é–“é¢æ¿ */
        #time-panel {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            width: 500px;
            background: rgba(10, 20, 40, 0.95);
            border: 2px solid #ffaa00;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            z-index: 100;
            box-shadow: 0 0 30px rgba(255, 170, 0, 0.3);
        }

        .time-label {
            font-size: 14px;
            color: #ffaa00;
            text-transform: uppercase;
            margin-bottom: 10px;
            letter-spacing: 1px;
        }

        .time-display {
            font-size: 28px;
            color: #00ff88;
            font-weight: bold;
            font-family: 'Courier New', monospace;
            margin-bottom: 15px;
        }

        .time-slider {
            width: 100%;
            height: 6px;
            -webkit-appearance: none;
            appearance: none;
            background: linear-gradient(to right, #001a4d 0%, #ffaa00 50%, #330033 100%);
            outline: none;
            border-radius: 3px;
            cursor: pointer;
        }

        .time-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 14px;
            height: 14px;
            background: #00ff88;
            cursor: pointer;
            border-radius: 50%;
            box-shadow: 0 0 10px #00ff88;
        }

        .time-slider::-moz-range-thumb {
            width: 14px;
            height: 14px;
            background: #00ff88;
            cursor: pointer;
            border-radius: 50%;
            border: none;
            box-shadow: 0 0 10px #00ff88;
        }

        /* æ§åˆ¶é¢æ¿ */
        #control-panel {
            position: absolute;
            bottom: 30px;
            right: 20px;
            width: 280px;
            background: rgba(10, 20, 40, 0.95);
            border: 2px solid #00ccff;
            border-radius: 10px;
            padding: 15px;
            z-index: 100;
            box-shadow: 0 0 30px rgba(0, 204, 255, 0.3);
        }

        .control-title {
            font-size: 12px;
            color: #00ccff;
            text-transform: uppercase;
            margin-bottom: 12px;
            letter-spacing: 1px;
        }

        .floor-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 15px;
        }

        .floor-btn {
            background: rgba(0, 204, 255, 0.2);
            color: #00ccff;
            border: 1px solid #00ccff;
            padding: 10px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 11px;
            font-weight: bold;
            transition: all 0.3s;
            text-transform: uppercase;
        }

        .floor-btn:hover {
            background: rgba(0, 204, 255, 0.4);
            box-shadow: 0 0 10px #00ccff;
        }

        .floor-btn.active {
            background: #00ccff;
            color: #000;
            box-shadow: 0 0 15px #00ccff;
        }

        .control-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .control-btn {
            background: rgba(0, 204, 255, 0.2);
            color: #00ccff;
            border: 1px solid #00ccff;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 10px;
            transition: all 0.3s;
        }

        .control-btn:hover {
            background: rgba(0, 204, 255, 0.4);
        }

        .control-btn.active {
            background: #00ccff;
            color: #000;
        }

        /* çµ±è¨ˆä¿¡æ¯ */
        #stats {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(10, 20, 40, 0.8);
            border: 1px solid #00ccff;
            color: #00ff88;
            padding: 12px 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            z-index: 10;
        }

        .stat-row {
            padding: 2px 0;
        }

        /* èªªæ˜æ–‡å­— */
        #help-text {
            position: absolute;
            bottom: 10px;
            left: 20px;
            color: #666;
            font-size: 11px;
            z-index: 10;
        }
    </style>
</head>
<body>
    <div id="left-panel">
        <div class="panel-title">ğŸ¢ èµ¤åœŸå´å¤šåŠŸèƒ½é¤¨</div>

        <div class="section">
            <div class="section-title">ğŸ“Š åŸºæœ¬è¦æ ¼</div>
            <div class="spec-item">
                <span class="spec-label">é è¨ˆè½æˆï¼š</span>
                <span class="spec-value">2028å¹´Q2</span>
            </div>
            <div class="spec-item">
                <span class="spec-label">å»ºç¯‰é¢ç©ï¼š</span>
                <span class="spec-value">3,833 mÂ²</span>
            </div>
            <div class="spec-item">
                <span class="spec-label">æ¨“å±¤æ•¸ï¼š</span>
                <span class="spec-value">6å±¤ (B1-6F)</span>
            </div>
            <div class="spec-item">
                <span class="spec-label">å»ºç¯‰é«˜åº¦ï¼š</span>
                <span class="spec-value">26.5å…¬å°º</span>
            </div>
            <div class="spec-item">
                <span class="spec-label">æ¨“å±¤å‡é¢ï¼š</span>
                <span class="spec-value">640 mÂ²/å±¤</span>
            </div>
        </div>

        <div class="section">
            <div class="section-title">ğŸ’° æŠ•è³‡æˆæœ¬</div>
            <div class="spec-item">
                <span class="spec-label">å»ºé€ æˆæœ¬ï¼š</span>
                <span class="spec-value">NT$228.7M</span>
            </div>
            <div class="spec-item">
                <span class="spec-label">è¨­ç›£è²»ç”¨ï¼š</span>
                <span class="spec-value">NT$22.9M</span>
            </div>
            <div class="spec-item">
                <span class="spec-label">å¹´åº¦ç‡Ÿé‹ï¼š</span>
                <span class="spec-value">NT$15.96M</span>
            </div>
            <div class="spec-item">
                <span class="spec-label">å¹´åº¦èµ¤å­—ï¼š</span>
                <span class="spec-value">NT$10M (å¸‚åºœè£œ)</span>
            </div>
        </div>

        <div class="section">
            <div class="section-title">ğŸ¨ å»ºç¯‰è¨­è¨ˆ</div>
            <div class="spec-item">
                <span class="spec-label">è¨­è¨ˆç†å¿µï¼š</span>
                <span class="spec-value">å…‰å½±æ¨“é–£</span>
            </div>
            <div class="spec-item">
                <span class="spec-label">å¤–è§€ç«‹é¢ï¼š</span>
                <span class="spec-value">åˆ†å±¤éé€²</span>
            </div>
            <div class="spec-item">
                <span class="spec-label">B1-2Fè‰²èª¿ï¼š</span>
                <span class="spec-value">æš–ç°è‰²(å®ˆè­·)</span>
            </div>
            <div class="spec-item">
                <span class="spec-label">3Fé€æ˜ç‡ï¼š</span>
                <span class="spec-value">50% (é–‹æ”¾)</span>
            </div>
            <div class="spec-item">
                <span class="spec-label">4F-6Fè‰²èª¿ï¼š</span>
                <span class="spec-value">ç™½è‰²(å¸Œæœ›)</span>
            </div>
        </div>

        <div class="section">
            <div class="section-title">ğŸŒ± ç¶ èƒ½ç³»çµ±</div>
            <div class="spec-item">
                <span class="spec-label">å¤ªé™½èƒ½å®¹é‡ï¼š</span>
                <span class="spec-value">50 kWp</span>
            </div>
            <div class="spec-item">
                <span class="spec-label">å¹´ç™¼é›»é‡ï¼š</span>
                <span class="spec-value">60,000 kWh</span>
            </div>
            <div class="spec-item">
                <span class="spec-label">å¹´åº¦çœé›»è²»ï¼š</span>
                <span class="spec-value">NT$270K</span>
            </div>
            <div class="spec-item">
                <span class="spec-label">ç¶ å±‹é ‚é¢ç©ï¼š</span>
                <span class="spec-value">250 mÂ²</span>
            </div>
            <div class="spec-item">
                <span class="spec-label">åœ°ç†±ç³»çµ±ï¼š</span>
                <span class="spec-value">5å­”é‘½æ¢</span>
            </div>
        </div>

        <div class="section">
            <div class="section-title">ğŸ‘¥ æœå‹™å®¹é‡</div>
            <div class="spec-item">
                <span class="spec-label">é•·ç…§æ—¥ç…§ï¼š</span>
                <span class="spec-value">80äºº/æ—¥</span>
            </div>
            <div class="spec-item">
                <span class="spec-label">å…¬å…±æ‰˜å¬°ï¼š</span>
                <span class="spec-value">50äºº/æ—¥</span>
            </div>
            <div class="spec-item">
                <span class="spec-label">è¦ªå­å…±å­¸ï¼š</span>
                <span class="spec-value">60å®¶åº­</span>
            </div>
            <div class="spec-item">
                <span class="spec-label">é’å°‘å¹´æ´»å‹•ï¼š</span>
                <span class="spec-value">100äºº</span>
            </div>
            <div class="spec-item">
                <span class="spec-label">å¹´åº¦å—æƒ ï¼š</span>
                <span class="spec-value">45,000äººæ¬¡</span>
            </div>
        </div>

        <div class="section">
            <div class="section-title">âš™ï¸ å››å¤§å‰µæ–°ç³»çµ±</div>
            <div class="spec-item">
                <span class="spec-label">1ï¸âƒ£ AIè¨˜æ†¶é‡ç”Ÿ</span>
                <span class="spec-value">1Fé•·ç…§</span>
            </div>
            <div class="spec-item">
                <span class="spec-label">2ï¸âƒ£ SIDSç›£æ¸¬</span>
                <span class="spec-value">2Fæ‰˜å¬°</span>
            </div>
            <div class="spec-item">
                <span class="spec-label">3ï¸âƒ£ æ™‚é–“éŠ€è¡Œ</span>
                <span class="spec-value">3Fç®¡ç†</span>
            </div>
            <div class="spec-item">
                <span class="spec-label">4ï¸âƒ£ VRå…±å­¸æ•™å®¤</span>
                <span class="spec-value">4Fé’å°‘å¹´</span>
            </div>
        </div>
    </div>

    <div id="right-panel">
        <div class="floor-detail-title" id="floor-title">6F - å…¬å…±æœƒè­°å»³+éœ²è‡º</div>
        <div class="floor-detail-desc" id="floor-desc">
            å¤šåŠŸèƒ½æœƒè­°å»³ï¼ˆ300äººå®¹ç´ï¼‰ï¼Œå±‹é ‚éœ²è‡ºçœºæœ›èµ¤åœŸå´å…¬åœ’èˆ‡ç«¹ç§‘åœ’å€ã€‚é…å‚™4KæŠ•å½±ç³»çµ±ã€åŒæ­¥ç¿»è­¯ã€è¦–è¨Šæœƒè­°ç³»çµ±ã€‚
        </div>

        <div style="background: rgba(0, 255, 136, 0.1); padding: 12px; border-radius: 6px; margin-top: 15px;">
            <div style="font-size: 11px; color: #888; margin-bottom: 8px;">æ¨“å±¤è³‡è¨Š</div>
            <div class="spec-item">
                <span class="spec-label">é«˜åº¦ä½ç½®ï¼š</span>
                <span class="spec-value" id="floor-height">26.5m</span>
            </div>
            <div class="spec-item">
                <span class="spec-label">æ¨“å±¤é¢ç©ï¼š</span>
                <span class="spec-value">640 mÂ²</span>
            </div>
            <div class="spec-item">
                <span class="spec-label">æ¨“å±¤é«˜åº¦ï¼š</span>
                <span class="spec-value">3.5m</span>
            </div>
        </div>

        <div style="background: rgba(255, 0, 255, 0.1); padding: 12px; border-radius: 6px; margin-top: 15px;">
            <div style="font-size: 11px; color: #888; margin-bottom: 8px;">å»ºç¯‰è‰²å½©</div>
            <div style="display: flex; gap: 10px; align-items: center;">
                <div style="width: 30px; height: 30px; background: #f0f0f0; border: 1px solid #00ccff; border-radius: 4px;"></div>
                <span style="color: #00ff88; font-size: 11px;">ç™½è‰²ç»ç’ƒå¹•ç‰†</span>
            </div>
            <div style="display: flex; gap: 10px; align-items: center; margin-top: 8px;">
                <div style="width: 30px; height: 30px; background: #228b22; border: 1px solid #00ccff; border-radius: 4px;"></div>
                <span style="color: #00ff88; font-size: 11px;">ç¶ å±‹é ‚ (éš”ç†±)</span>
            </div>
            <div style="display: flex; gap: 10px; align-items: center; margin-top: 8px;">
                <div style="width: 30px; height: 30px; background: #1e90ff; border: 1px solid #00ccff; border-radius: 4px;"></div>
                <span style="color: #00ff88; font-size: 11px;">å¤ªé™½èƒ½é¢æ¿</span>
            </div>
        </div>
    </div>

    <div id="time-panel">
        <div class="time-label">â˜€ï¸ æ—¥å…‰æ™‚é–“æ¨¡æ“¬</div>
        <div class="time-display" id="time-display">12:00</div>
        <input type="range" id="time-slider" class="time-slider" min="0" max="24" value="12" step="0.1">
        <div style="display: flex; justify-content: space-between; margin-top: 10px; font-size: 10px; color: #888;">
            <span>ğŸŒ… æ™¨å…‰ (06:00)</span>
            <span>â˜€ï¸ åˆé–“ (12:00)</span>
            <span>ğŸŒ† å¤•ç…§ (18:00)</span>
            <span>ğŸŒ™ å¤œé–“ (00:00)</span>
        </div>
    </div>

    <div id="control-panel">
        <div class="control-title">ğŸ® æ¨“å±¤é¸æ“‡</div>
        <div class="floor-buttons">
            <button class="floor-btn" onclick="selectFloor('B1')">B1 åœè»Š</button>
            <button class="floor-btn" onclick="selectFloor('1F')">1F é•·ç…§</button>
            <button class="floor-btn" onclick="selectFloor('2F')">2F æ‰˜å¬°</button>
            <button class="floor-btn" onclick="selectFloor('3F')">3F å®¶åº­</button>
            <button class="floor-btn" onclick="selectFloor('4F')">4F é’å°‘å¹´</button>
            <button class="floor-btn" onclick="selectFloor('5F')">5F ç¶ èƒ½</button>
            <button class="floor-btn active" onclick="selectFloor('6F')">6F æœƒè­°</button>
        </div>

        <div class="control-title" style="margin-top: 15px;">âš™ï¸ æª¢è¦–æ¨¡å¼</div>
        <div class="control-buttons">
            <button class="control-btn active" onclick="toggleMode('normal')">æ­£å¸¸</button>
            <button class="control-btn" onclick="toggleMode('wireframe')">ç·šæ¡†</button>
            <button class="control-btn" onclick="toggleMode('highlight')">äº®åº¦</button>
        </div>
    </div>

    <div id="stats">
        <div class="stat-row">ğŸ“Š FPS: <span id="fps">60</span></div>
        <div class="stat-row">ğŸ”· Objects: <span id="obj-count">0</span></div>
        <div class="stat-row">ğŸ“ Triangles: <span id="tri-count">0</span></div>
        <div class="stat-row">ğŸ• Time: <span id="sim-time">12:00</span></div>
    </div>

    <div id="help-text">
        ğŸ’¡ æç¤ºï¼šç”¨æ»‘é¼ æ‹–å‹•æ—‹è½‰ | æ»¾è¼ªç¸®æ”¾ | æ‹–å‹•ä¸‹æ–¹æ»‘å¡Šæ”¹è®Šå…‰ç·š
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@r128/examples/js/controls/OrbitControls.js"></script>

    <script>
        // ==================== å…¨å±€è®Šé‡ ====================
        let scene, camera, renderer, controls;
        let building, floorMeshes = {};
        let currentFloor = '6F';
        let currentMode = 'normal';
        let sunIntensity = 0.8;
        let frameCount = 0, lastTime = Date.now(), fps = 0;
        let lightController = null;

        // æ¨“å±¤æ•¸æ“š
        const floorData = {
            B1: {
                name: 'B1 - åœè»Šå ´+æ©Ÿæˆ¿',
                height: 0,
                totalHeight: 5,
                color: 0x7a7a7a,
                desc: 'åœ°é¢åœè»Š60è»Šä½ã€ç©ºèª¿æ©Ÿæˆ¿ã€é…é›»å®¤ã€UPSã€çµ¦æ’æ°´ç³»çµ±ã€å€å¡Šéˆç¯€é»ã€‚æ·±ç°è‰²æ¸…æ°´æ··å‡åœŸï¼Œè±¡å¾µåŸºç¤èˆ‡æ”¯æ’ã€‚'
            },
            '1F': {
                name: '1F - AIè¨˜æ†¶é‡ç”Ÿ+é•·ç…§æ—¥ç…§',
                height: 5,
                totalHeight: 4,
                color: 0x9a9a9a,
                desc: 'å¤±æ™ºç—‡å°ˆå€(200 mÂ²)ã€æŠ•å½±é«”é©—ã€ç©¿æˆ´ç›£æ¸¬ã€æ—¥ç…§æ´»å‹•å€(80äºº)ã€‚æš–ç°è‰²æ¸…æ°´æ··å‡åœŸï¼Œè±¡å¾µå®ˆè­·èˆ‡é—œæ‡·ã€‚'
            },
            '2F': {
                name: '2F - SIDSç›£æ¸¬+å…¬å…±æ‰˜å¬°',
                height: 9,
                totalHeight: 3.5,
                color: 0x9a9a9a,
                desc: 'SIDSç›£æ¸¬ç³»çµ±(50åºŠ)ã€æ‰˜å¬°æ´»å‹•å€ã€æ„ŸæŸ“éš”é›¢è¨­è¨ˆã€‚èˆ‡1Fç›¸åŒè‰²èª¿ï¼Œè±¡å¾µé€£çºŒçš„é—œæ‡·ã€‚'
            },
            '3F': {
                name: '3F - è¦ªå­å…±å­¸+æ™‚é–“éŠ€è¡Œ',
                height: 12.5,
                totalHeight: 3.5,
                color: 0xb0b0b0,
                desc: 'è¦ªå­å…±å­¸å€ã€æ™‚é–“éŠ€è¡Œç®¡ç†ä¸­å¿ƒã€MRäº’å‹•ç©ºé–“ã€æ•…äº‹åŠ‡å ´ã€‚æ·ºç°è‰²+50%ç»ç’ƒï¼Œè±¡å¾µé–‹æ”¾èˆ‡é€£çµã€‚'
            },
            '4F': {
                name: '4F - å…ƒå®‡å®™å…±å­¸æ•™å®¤+é’å°‘å¹´',
                height: 16,
                totalHeight: 3.5,
                color: 0xf5f5f5,
                desc: 'STEMæ•™å®¤ã€VRæ²‰æµ¸æ•™å®¤ã€è·æ¶¯å°å¸«å€ã€é è·æ•™å­¸ã€‚ç™½è‰²ç»ç’ƒå¹•ç‰†ï¼Œè±¡å¾µé–‹æ”¾çš„æœªä¾†ã€‚'
            },
            '5F': {
                name: '5F - ç¶ èƒ½+å¤šåŠŸèƒ½åŸ¹è¨“',
                height: 19.5,
                totalHeight: 3.5,
                color: 0xf5f5f5,
                desc: 'å¤ªé™½èƒ½50kWpã€ç¶ å±‹é ‚ã€å“¡å·¥åŸ¹è¨“ä¸­å¿ƒã€ç ”ç©¶å¯¦é©—å®¤ã€‚ç™½è‰²ç»ç’ƒå¹•ç‰†ï¼Œå±•ç¾æ°¸çºŒæ‰¿è«¾ã€‚'
            },
            '6F': {
                name: '6F - å…¬å…±æœƒè­°å»³+éœ²è‡º',
                height: 23,
                totalHeight: 3.5,
                color: 0xf0f0f0,
                desc: 'å¤šåŠŸèƒ½æœƒè­°å»³(300äºº)ã€å±‹é ‚éœ²è‡º(200 mÂ²)ã€çœºæœ›èµ¤åœŸå´å…¬åœ’èˆ‡ç«¹ç§‘åœ’å€ã€‚ç™½è‰²ç»ç’ƒå¹•ç‰†ï¼Œè±¡å¾µç¤¾å€çš„ç‡ˆå¡”ã€‚'
            }
        };

        // ==================== åˆå§‹åŒ– ====================
        function init() {
            // å ´æ™¯
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x001a4d); // æ·±è—è‰²å¤œç©º
            scene.fog = new THREE.Fog(0x001a4d, 300, 800);

            // ç›¸æ©Ÿ
            camera = new THREE.PerspectiveCamera(
                65,
                window.innerWidth / window.innerHeight,
                0.1,
                2000
            );
            camera.position.set(60, 35, 60);
            camera.lookAt(0, 15, 0);

            // æ¸²æŸ“å™¨
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFShadowShadowMap;
            renderer.outputEncoding = THREE.sRGBColorSpace;
            document.body.appendChild(renderer.domElement);

            // æ§åˆ¶
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.maxDistance = 250;
            controls.minDistance = 20;

            // å‰µå»ºå»ºç¯‰
            createBuilding();

            // å…‰æº
            createLights();

            // åœ°é¢
            createEnvironment();

            // æ™‚é–“æ»‘å¡Šç›£è½
            document.getElementById('time-slider').addEventListener('input', updateTime);

            // çª—å£èª¿æ•´
            window.addEventListener('resize', onWindowResize);

            // é–‹å§‹å‹•ç•«
            animate();
        }

        // ==================== å‰µå»ºå»ºç¯‰ ====================
        function createBuilding() {
            building = new THREE.Group();
            scene.add(building);

            const buildingWidth = 32;
            const buildingDepth = 20;

            // å‰µå»ºæ¯ä¸€å±¤
            Object.keys(floorData).forEach((floorKey) => {
                const data = floorData[floorKey];

                const geometry = new THREE.BoxGeometry(buildingWidth, data.totalHeight, buildingDepth);

                let materials = [];
                for (let i = 0; i < 6; i++) {
                    const isGlass = ['3F', '4F', '5F', '6F'].includes(floorKey);
                    const isSemiGlass = floorKey === '3F';

                    let material;
                    if (isSemiGlass && (i === 1 || i === 4)) {
                        // 3Fçš„å´é¢ä½¿ç”¨åŠé€æ˜ç»ç’ƒ
                        material = new THREE.MeshPhongMaterial({
                            color: 0xb0b0b0,
                            transparent: true,
                            opacity: 0.7,
                            emissive: 0x333333,
                            shininess: 100
                        });
                    } else if (isGlass && (i === 1 || i === 4)) {
                        // 4F-6Fçš„å´é¢ä½¿ç”¨ç»ç’ƒ
                        material = new THREE.MeshPhongMaterial({
                            color: 0xffffff,
                            transparent: true,
                            opacity: 0.8,
                            emissive: 0x444444,
                            shininess: 80
                        });
                    } else {
                        // å…¶ä»–é¢ä½¿ç”¨æ··å‡åœŸ
                        material = new THREE.MeshPhongMaterial({
                            color: data.color,
                            emissive: 0x222222,
                            shininess: 40
                        });
                    }
                    materials.push(material);
                }

                const mesh = new THREE.Mesh(geometry, materials);
                mesh.castShadow = true;
                mesh.receiveShadow = true;
                mesh.position.y = data.height + data.totalHeight / 2;
                mesh.userData = { floor: floorKey, data: data };

                // æ·»åŠ é‚Šæ¡†
                const edges = new THREE.EdgesGeometry(geometry);
                const lineSegments = new THREE.LineSegments(
                    edges,
                    new THREE.LineBasicMaterial({ color: 0x444444, linewidth: 1 })
                );
                lineSegments.position.copy(mesh.position);
                building.add(lineSegments);

                building.add(mesh);
                floorMeshes[floorKey] = mesh;

                // æ·»åŠ çª—æˆ¶ï¼ˆç°¡åŒ–ç‰ˆï¼‰
                addWindows(mesh, floorKey, buildingWidth, buildingDepth);
            });

            // å‰µå»ºå±‹é ‚
            createRoof(26.5, buildingWidth, buildingDepth);

            // å‰µå»ºå…¥å£
            createEntrance(buildingWidth, buildingDepth);
        }

        function addWindows(floorMesh, floorKey, width, depth) {
            const windowSize = 2;
            const windowSpacing = 3;

            // åœ¨å»ºç¯‰å´é¢æ·»åŠ çª—æˆ¶
            if (['4F', '5F', '6F'].includes(floorKey)) {
                // å‰µå»ºçª—æˆ¶ç¶²æ ¼
                for (let x = -width / 2 + 2; x < width / 2 - 2; x += windowSpacing) {
                    for (let z = -depth / 2 + 2; z < depth / 2 - 2; z += windowSpacing) {
                        const windowGeometry = new THREE.PlaneGeometry(windowSize, windowSize);
                        const windowMaterial = new THREE.MeshPhongMaterial({
                            color: 0x87ceeb, // å¤©è—è‰²ï¼ˆç»ç’ƒåå…‰ï¼‰
                            emissive: 0x1a5c7a,
                            shininess: 120,
                            side: THREE.DoubleSide
                        });

                        const windowMesh = new THREE.Mesh(windowGeometry, windowMaterial);
                        windowMesh.position.set(x, 0, z);
                        windowMesh.position.z -= depth / 2 + 0.1;
                        windowMesh.position.y += floorMesh.position.y - floorMesh.geometry.parameters.height / 2 + 0.5;
                        windowMesh.castShadow = true;
                        building.add(windowMesh);
                    }
                }
            }
        }

        function createRoof(yPos, width, depth) {
            // å¤ªé™½èƒ½é¢æ¿
            const panelCount = 16;
            for (let i = 0; i < panelCount; i++) {
                const panelGeometry = new THREE.BoxGeometry(width / 5, 0.15, depth / 4);
                const panelMaterial = new THREE.MeshPhongMaterial({
                    color: 0x1e90ff,
                    emissive: 0x0066cc,
                    shininess: 100
                });
                const panelMesh = new THREE.Mesh(panelGeometry, panelMaterial);
                panelMesh.position.set(
                    -12 + (i % 4) * 8,
                    yPos + 0.2,
                    -7 + Math.floor(i / 4) * 5
                );
                panelMesh.castShadow = true;
                panelMesh.receiveShadow = true;
                building.add(panelMesh);
            }

            // ç¶ å±‹é ‚
            const greenGeometry = new THREE.PlaneGeometry(width * 0.7, depth * 0.7);
            const greenMaterial = new THREE.MeshPhongMaterial({
                color: 0x2d8659,
                emissive: 0x1a4d31,
                shininess: 20
            });
            const greenRoof = new THREE.Mesh(greenGeometry, greenMaterial);
            greenRoof.rotation.x = -Math.PI / 2;
            greenRoof.position.set(0, yPos + 0.3, 0);
            greenRoof.receiveShadow = true;
            building.add(greenRoof);
        }

        function createEntrance(width, depth) {
            const entranceGeometry = new THREE.PlaneGeometry(width * 2.5, depth * 1.8);
            const entranceMaterial = new THREE.MeshPhongMaterial({
                color: 0xb8b8b8,
                side: THREE.DoubleSide
            });
            const entrance = new THREE.Mesh(entranceGeometry, entranceMaterial);
            entrance.rotation.x = -Math.PI / 2;
            entrance.position.y = -0.15;
            entrance.receiveShadow = true;
            building.add(entrance);
        }

        // ==================== å…‰æºè¨­ç½® ====================
        function createLights() {
            // ç’°å¢ƒå…‰
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
            scene.add(ambientLight);

            // ä¸»æ–¹å‘å…‰ï¼ˆå¤ªé™½ï¼‰
            lightController = {
                sun: new THREE.DirectionalLight(0xffffff, 0.8),
                sky: new THREE.HemisphereLight(0x87ceeb, 0x2d5016, 0.5),
                moon: new THREE.DirectionalLight(0x8899ff, 0.3)
            };

            lightController.sun.position.set(80, 60, 40);
            lightController.sun.target.position.set(0, 10, 0);
            lightController.sun.castShadow = true;
            lightController.sun.shadow.mapSize.width = 2048;
            lightController.sun.shadow.mapSize.height = 2048;
            lightController.sun.shadow.camera.far = 500;
            lightController.sun.shadow.camera.left = -150;
            lightController.sun.shadow.camera.right = 150;
            lightController.sun.shadow.camera.top = 150;
            lightController.sun.shadow.camera.bottom = -150;
            scene.add(lightController.sun);

            lightController.moon.position.set(-80, 60, -40);
            lightController.moon.target.position.set(0, 10, 0);
            scene.add(lightController.moon);

            scene.add(lightController.sky);

            // é»å…‰æºï¼ˆè£é£¾ï¼‰
            const pointLight = new THREE.PointLight(0xffaa44, 0.4);
            pointLight.position.set(-60, 40, 60);
            scene.add(pointLight);
        }

        // ==================== ç’°å¢ƒå‰µå»º ====================
        function createEnvironment() {
            // åœ°é¢
            const groundGeometry = new THREE.PlaneGeometry(300, 300);
            const groundMaterial = new THREE.MeshPhongMaterial({
                color: 0x1a4d1a,
                side: THREE.DoubleSide
            });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.position.y = -0.5;
            ground.receiveShadow = true;
            scene.add(ground);

            // é æ™¯ï¼ˆå…¬åœ’ï¼‰
            const skyGeometry = new THREE.SphereGeometry(600, 32, 16, 0, Math.PI * 2, 0, Math.PI / 2);
            const skyMaterial = new THREE.MeshBasicMaterial({
                color: 0x001a4d,
                side: THREE.BackSide
            });
            const sky = new THREE.Mesh(skyGeometry, skyMaterial);
            sky.position.y = 200;
            scene.add(sky);
        }

        // ==================== æ™‚é–“æ§åˆ¶ ====================
        function updateTime(event) {
            const hour = parseFloat(event.target.value);
            const minute = Math.floor((hour % 1) * 60);
            const hourInt = Math.floor(hour);

            // æ›´æ–°é¡¯ç¤º
            const timeStr = `${String(hourInt).padStart(2, '0')}:${String(minute).padStart(2, '0')}`;
            document.getElementById('time-display').textContent = timeStr;
            document.getElementById('sim-time').textContent = timeStr;

            // è¨ˆç®—å…‰ç·šå¼·åº¦
            // æ™¨å…‰ï¼š6-9é»é€æ¼¸è®Šäº®
            // åˆé–“ï¼š9-16é»æœ€äº®
            // å¤•ç…§ï¼š16-18é»é€æ¼¸è®Šæš—
            // å¤œé–“ï¼š18-6é»æœ€æš—

            let sunX, sunY, sunIntensity, skyColor, fogColor;

            if (hour >= 6 && hour < 9) {
                // æ™¨å…‰
                const progress = (hour - 6) / 3;
                sunIntensity = 0.3 + 0.5 * progress;
                sunX = 80 - 60 * progress;
                sunY = 20 + 40 * progress;
                skyColor = new THREE.Color().lerpColors(
                    new THREE.Color(0x1a1a2e),
                    new THREE.Color(0x667eea),
                    progress
                );
            } else if (hour >= 9 && hour < 16) {
                // åˆé–“
                sunIntensity = 0.8;
                sunX = 20;
                sunY = 60;
                skyColor = new THREE.Color(0x667eea);
            } else if (hour >= 16 && hour < 18) {
                // å¤•ç…§
                const progress = (hour - 16) / 2;
                sunIntensity = 0.8 - 0.6 * progress;
                sunX = 20 + 60 * progress;
                sunY = 60 - 40 * progress;
                skyColor = new THREE.Color().lerpColors(
                    new THREE.Color(0x667eea),
                    new THREE.Color(0xff6b35),
                    progress
                );
            } else {
                // å¤œé–“
                sunIntensity = 0.2;
                sunX = -80;
                sunY = 20;
                skyColor = new THREE.Color(0x001a4d);
            }

            // æ‡‰ç”¨å…‰ç·šæ›´æ–°
            lightController.sun.position.set(sunX, sunY, 40);
            lightController.sun.intensity = Math.max(0.1, sunIntensity);
            lightController.moon.intensity = Math.max(0, 0.5 - sunIntensity);
            lightController.sky.groundColor.copy(skyColor);
            scene.background.copy(skyColor);
            scene.fog.color.copy(skyColor);
        }

        // ==================== æ¨“å±¤é¸æ“‡ ====================
        function selectFloor(floorKey) {
            // æ›´æ–°UI
            document.querySelectorAll('.floor-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // æ›´æ–°æ¨“å±¤è©³æƒ…
            const data = floorData[floorKey];
            document.getElementById('floor-title').textContent = data.name;
            document.getElementById('floor-desc').textContent = data.desc;
            document.getElementById('floor-height').textContent = `${data.height + data.totalHeight}m`;

            // é«˜äº®æ¨“å±¤
            Object.keys(floorMeshes).forEach(key => {
                const mesh = floorMeshes[key];
                if (key === floorKey) {
                    mesh.material.forEach(mat => {
                        mat.emissive.setHex(0xff00ff);
                        mat.emissiveIntensity = 0.6;
                    });
                } else {
                    mesh.material.forEach(mat => {
                        mat.emissive.setHex(0x222222);
                        mat.emissiveIntensity = 0.1;
                    });
                }
            });

            currentFloor = floorKey;

            // ç›¸æ©Ÿä½ç½®å¹³æ»‘ç§»å‹•åˆ°æ¨“å±¤
            const targetY = data.height + 20;
            cameraAnimateTo(camera.position.x, targetY, camera.position.z, 1000);
        }

        function cameraAnimateTo(x, y, z, duration) {
            const startPos = camera.position.clone();
            const startTime = Date.now();

            const animate = () => {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / duration, 1);

                camera.position.y = startPos.y + (y - startPos.y) * progress;

                if (progress < 1) {
                    requestAnimationFrame(animate);
                }
            };

            animate();
        }

        // ==================== æ¨¡å¼åˆ‡æ› ====================
        function toggleMode(mode) {
            currentMode = mode;

            Object.keys(floorMeshes).forEach(key => {
                const mesh = floorMeshes[key];
                mesh.material.forEach(mat => {
                    if (mode === 'wireframe') {
                        mat.wireframe = true;
                    } else {
                        mat.wireframe = false;
                    }
                });
            });

            document.querySelectorAll('.control-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        // ==================== å‹•ç•«å¾ªç’° ====================
        function animate() {
            requestAnimationFrame(animate);

            // çµ±è¨ˆæ›´æ–°
            frameCount++;
            const now = Date.now();
            if (now >= lastTime + 1000) {
                fps = frameCount;
                document.getElementById('fps').textContent = fps;
                document.getElementById('obj-count').textContent = scene.children.length;
                frameCount = 0;
                lastTime = now;
            }

            // å»ºç¯‰æ—‹è½‰ï¼ˆå¯é¸ï¼‰
            if (!controls.isDragging) {
                building.rotation.y += 0.0002;
            }

            controls.update();
            renderer.render(scene, camera);
        }

        // ==================== çª—å£èª¿æ•´ ====================
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // åˆå§‹åŒ–
        window.addEventListener('load', init);
    </script>
</body>
</html>
