<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D å»ºç¯‰å¯è¦–åŒ– - èª¿è©¦ç‰ˆæœ¬</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { width: 100%; height: 100%; font-family: Arial, sans-serif; }
        #container { display: flex; flex-direction: column; height: 100%; }
        #topbar { background: #333; color: #fff; padding: 20px; }
        #canvas-container { flex: 1; background: #0a0e27; }
        #debug { background: #222; color: #0f0; font-family: monospace; padding: 20px; height: 200px; overflow-y: auto; }
        .success { color: #0f0; }
        .error { color: #f00; }
        .info { color: #0ff; }
    </style>
</head>
<body>
    <div id="container">
        <div id="topbar">
            <h1>èµ¤åœŸå´å¤šåŠŸèƒ½é¤¨ 3D å¯è¦–åŒ– - èª¿è©¦ç‰ˆæœ¬</h1>
            <p id="status">åˆå§‹åŒ–ä¸­...</p>
        </div>
        <canvas id="canvas-container"></canvas>
        <div id="debug"></div>
    </div>

    <script>
        const debugLog = [];
        const MAX_LOGS = 50;

        function log(msg, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const fullMsg = `[${timestamp}] ${msg}`;
            debugLog.push(fullMsg);
            if (debugLog.length > MAX_LOGS) debugLog.shift();
            updateDebugDisplay();
            console.log(msg);
        }

        function updateDebugDisplay() {
            const debugDiv = document.getElementById('debug');
            debugDiv.innerHTML = debugLog.map(m => {
                if (m.includes('âŒ') || m.includes('Error')) return `<div class="error">${m}</div>`;
                if (m.includes('âœ…')) return `<div class="success">${m}</div>`;
                return `<div class="info">${m}</div>`;
            }).join('');
            debugDiv.scrollTop = debugDiv.scrollHeight;
        }

        log('é–‹å§‹åŠ è¼‰ Three.js...', 'info');

        // ç›´æ¥åŠ è½½ three.jsï¼ˆä¸ç”¨ importmapï¼‰
        const script1 = document.createElement('script');
        script1.src = '/libs/three/three.module.js';
        script1.type = 'module';
        script1.onload = () => log('âœ… Three.js æ¨¡å¡ŠåŠ è¼‰æˆåŠŸ', 'success');
        script1.onerror = () => log('âŒ Three.js åŠ è¼‰å¤±æ•—', 'error');
        document.head.appendChild(script1);

        // ç­‰å¾… Three.js åŠ è½½
        let attempts = 0;
        function checkTHREE() {
            attempts++;
            log(`æª¢æŸ¥ THREE... (${attempts})`);
            if (typeof THREE !== 'undefined') {
                log('âœ… THREE å°è±¡å·²å®šç¾©', 'success');
                initScene();
            } else if (attempts < 50) {
                setTimeout(checkTHREE, 100);
            } else {
                log('âŒ Three.js åŠ è¼‰è¶…æ™‚', 'error');
                document.getElementById('status').innerHTML = '<span style="color: red;">âŒ Three.js åŠ è¼‰å¤±æ•—</span>';
            }
        }

        function initScene() {
            try {
                log('ğŸ—ï¸ é–‹å§‹åˆå§‹åŒ– Three.js å ´æ™¯...', 'info');

                const canvas = document.getElementById('canvas-container');
                const scene = new THREE.Scene();
                scene.background = new THREE.Color(0x0a0e27);
                log('âœ… Scene å‰µå»ºæˆåŠŸ', 'success');

                const camera = new THREE.PerspectiveCamera(75, canvas.clientWidth / canvas.clientHeight, 0.1, 1000);
                camera.position.set(50, 40, 50);
                log('âœ… Camera å‰µå»ºæˆåŠŸ', 'success');

                const renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true });
                renderer.setSize(canvas.clientWidth, canvas.clientHeight);
                renderer.setClearColor(0x0a0e27);
                log('âœ… Renderer å‰µå»ºæˆåŠŸ', 'success');

                // æ·»åŠ å…‰ç·š
                const light1 = new THREE.AmbientLight(0xffffff, 0.5);
                scene.add(light1);
                const light2 = new THREE.DirectionalLight(0xffffff, 0.7);
                light2.position.set(100, 100, 100);
                scene.add(light2);
                log('âœ… å…‰ç·šæ·»åŠ æˆåŠŸ', 'success');

                // æ·»åŠ ç°¡å–®çš„å»ºç¯‰
                const geometry = new THREE.BoxGeometry(32, 15, 20);
                const material = new THREE.MeshPhongMaterial({ color: 0x888888 });
                const building = new THREE.Mesh(geometry, material);
                building.position.y = 7.5;
                scene.add(building);
                log('âœ… å»ºç¯‰ç‰©æ·»åŠ æˆåŠŸ', 'success');

                // æ·»åŠ åœ°é¢
                const groundGeo = new THREE.PlaneGeometry(200, 200);
                const groundMat = new THREE.MeshPhongMaterial({ color: 0x2d5016 });
                const ground = new THREE.Mesh(groundGeo, groundMat);
                ground.rotation.x = -Math.PI / 2;
                scene.add(ground);
                log('âœ… åœ°é¢æ·»åŠ æˆåŠŸ', 'success');

                // åŠ¨ç”»å¾ªç¯
                function animate() {
                    requestAnimationFrame(animate);
                    building.rotation.y += 0.001;
                    renderer.render(scene, camera);
                }
                animate();
                log('âœ… å‹•ç•«å¾ªç’°é–‹å§‹', 'success');

                document.getElementById('status').innerHTML = '<span style="color: #0f0;">âœ… å ´æ™¯å·²åŠ è¼‰ï¼Œå»ºç¯‰ç‰©æ‡‰è©²åœ¨æ—‹è½‰</span>';
            } catch (err) {
                log(`âŒ åˆå§‹åŒ–éŒ¯èª¤: ${err.message}`, 'error');
                document.getElementById('status').innerHTML = `<span style="color: red;">âŒ åˆå§‹åŒ–å¤±æ•—: ${err.message}</span>`;
            }
        }

        // å¼€å§‹æ£€æŸ¥ THREE
        setTimeout(checkTHREE, 500);

        // ç›‘å¬çª—å£å¤§å°å˜åŒ–
        window.addEventListener('resize', () => {
            log('ğŸ“ çª—å£å¤§å°æ”¹è®Š', 'info');
        });
    </script>
</body>
</html>
