# ğŸ”§ å¤–éƒ¨è¦–è§’æ¨“å±¤å°èˆªä¿®å¾©å ±å‘Š

**å•é¡Œæ—¥æœŸ**: 2025-10-24
**å ±å‘Šç‹€æ…‹**: âœ… **å·²ä¿®å¾©**
**å„ªå…ˆç´š**: ğŸ”´ **é«˜å„ªå…ˆç´š** (å½±éŸ¿ç”¨æˆ¶é«”é©—)

---

## å•é¡Œæè¿°

### ç—‡ç‹€
åœ¨ã€Œå¤–éƒ¨è¦–è§’ã€æ¨¡å¼ä¸‹ï¼Œé»æ“Šå·¦é‚Šå°èˆªæ¬„çš„æ¨“å±¤æŒ‰éˆ•ï¼ˆ1Fã€2Fã€3Fã€4F ç­‰ï¼‰ï¼Œ**ç•«é¢æ²’æœ‰ä»»ä½•è®ŠåŒ–**ã€‚

ç”¨æˆ¶æœŸæœ›ï¼š
- âŒ ç›¸æ©Ÿæ‡‰è©²ç§»å‹•åˆ°è©²æ¨“å±¤é€²è¡ŒæŸ¥çœ‹
- âŒ æˆ¿é–“åˆ—è¡¨æ‡‰è©²æ›´æ–°é¡¯ç¤ºè©²æ¨“å±¤çš„æˆ¿é–“
- âŒ ä¿¡æ¯é¢æ¿æ‡‰è©²é¡¯ç¤ºè©²æ¨“å±¤çš„çµ±è¨ˆä¿¡æ¯
- âŒ minimap æ‡‰è©²æ›´æ–°

å¯¦éš›çµæœï¼š
- âŒ ç›¸æ©Ÿä½ç½®ä¸è®Š
- âœ“ æˆ¿é–“åˆ—è¡¨æ›´æ–°ï¼ˆä½†ç”¨æˆ¶çœ‹ä¸åˆ°ç›¸æ‡‰è®ŠåŒ–ï¼‰
- âœ“ ä¿¡æ¯é¢æ¿æ›´æ–°ï¼ˆä½†ç”¨æˆ¶çœ‹ä¸åˆ°ç›¸æ‡‰è®ŠåŒ–ï¼‰
- âœ“ minimap æ›´æ–°ï¼ˆä½†ç”¨æˆ¶çœ‹ä¸åˆ°ç›¸æ‡‰è®ŠåŒ–ï¼‰

### æ ¹æœ¬åŸå› 

`selectFloor()` å‡½æ•¸ï¼ˆç¬¬927è¡Œï¼‰åªè² è²¬ï¼š
1. æ›´æ–° `currentFloor` è®Šæ•¸
2. æ›´æ–°æŒ‰éˆ•çš„ active ç‹€æ…‹
3. æ›´æ–°æˆ¿é–“åˆ—è¡¨
4. æ›´æ–°ä¿¡æ¯é¢æ¿
5. æ›´æ–° minimap

**ç¼ºå¤±**ï¼šæ²’æœ‰æ”¹è®Šç›¸æ©Ÿä½ç½®ä¾†èšç„¦åˆ°æ–°æ¨“å±¤ï¼

åœ¨å¤–éƒ¨è¦–è§’æ¨¡å¼ä¸‹ï¼Œç›¸æ©Ÿä½ç½®æ˜¯å›ºå®šçš„ï¼š
```javascript
orbitCamera.position.set(80, 60, 80);      // ä¿®å¾©å‰ï¼šå›ºå®šä½ç½®
orbitControls.target.set(0, 15, 0);        // ä¿®å¾©å‰ï¼šå›ºå®šç„¦é»
```

æ‰€ä»¥ç”¨æˆ¶é»æ“Šä¸åŒæ¨“å±¤æ™‚ï¼Œç›¸æ©Ÿä¸æœƒæ”¹è®Šä½ç½®ï¼Œå°è‡´æ²’æœ‰è¦–è¦ºåé¥‹ã€‚

---

## ä¿®å¾©æ–¹æ¡ˆ

### ä¿®å¾©å…§å®¹

ä¿®æ”¹ `selectFloor()` å‡½æ•¸ï¼Œæ·»åŠ å¤–éƒ¨è¦–è§’æ¨¡å¼ä¸‹çš„ç›¸æ©Ÿæ§åˆ¶é‚è¼¯ï¼š

```javascript
function selectFloor(floor) {
    currentFloor = floor;
    window.currentFloor = floor;

    // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
    document.querySelectorAll('.floor-btn').forEach(btn => {
        if (btn.textContent.includes(floor.substring(0, 2))) {
            btn.classList.add('active');
        } else {
            btn.classList.remove('active');
        }
    });

    // âœ¨ æ–°å¢ï¼šå¤–éƒ¨è¦–è§’æ¨¡å¼ä¸‹çš„ç›¸æ©Ÿæ§åˆ¶
    if (currentMode === 'exterior') {
        // è¨ˆç®—è©²æ¨“å±¤çš„ä¸­å¿ƒyåæ¨™
        let floorIndex = BUILDING_CONFIG.floors.indexOf(floor);
        let floorCenterY = 0;

        // è¨ˆç®—æ¨“å±¤ä¸­å¿ƒé«˜åº¦
        for (let i = 0; i < floorIndex; i++) {
            floorCenterY += BUILDING_CONFIG.floorHeights[i];
        }
        floorCenterY += BUILDING_CONFIG.floorHeights[floorIndex] / 2;

        // å¹³æ»‘åœ°ç§»å‹•ç›¸æ©Ÿåˆ°æ–°æ¨“å±¤
        orbitCamera.position.set(80, floorCenterY + 40, 80);
        orbitControls.target.set(0, floorCenterY, 0);
        orbitControls.update();
    }

    updateRoomsList();
    updateInfoPanel();
    drawMinimap();
}
```

### ä¿®å¾©é‚è¼¯è§£æ

#### ç¬¬ 1 æ­¥ï¼šè¨ˆç®—æ¨“å±¤ä¸­å¿ƒé«˜åº¦

æ ¹æ“š `BUILDING_CONFIG.floorHeights` è¨ˆç®—è©²æ¨“å±¤çš„yåæ¨™ï¼š

```
æ¨“å±¤é«˜åº¦é…ç½®ï¼š
- B1: 5m    â†’ 0 - 5m
- 1F: 4m    â†’ 5 - 9m
- 2F: 3.5m  â†’ 9 - 12.5m
- 3F: 3.5m  â†’ 12.5 - 16m
- 4F: 3.5m  â†’ 16 - 19.5m

æ¨“å±¤ä¸­å¿ƒè¨ˆç®—ï¼š
- B1 ä¸­å¿ƒ: 0 + 5/2 = 2.5m
- 1F ä¸­å¿ƒ: 5 + 4/2 = 7m
- 2F ä¸­å¿ƒ: 9 + 3.5/2 = 10.75m
- 3F ä¸­å¿ƒ: 12.5 + 3.5/2 = 14.25m
- 4F ä¸­å¿ƒ: 16 + 3.5/2 = 17.75m
```

#### ç¬¬ 2 æ­¥ï¼šè¨­ç½®ç›¸æ©Ÿä½ç½®

```javascript
orbitCamera.position.set(80, floorCenterY + 40, 80);
```

- x = 80 (æ±é‚Š)
- y = `floorCenterY + 40` (æ¨“å±¤ä¸­å¿ƒä¸Šæ–¹ 40 å–®ä½)
- z = 80 (å—é‚Š)

é€™æ¨£ç›¸æ©Ÿæœƒä¿æŒåœ¨å»ºç¯‰ç‰©çš„æ±å—æ–¹ï¼Œä½†é«˜åº¦æœƒéš¨è‘—æ¨“å±¤è®ŠåŒ–ã€‚

#### ç¬¬ 3 æ­¥ï¼šè¨­ç½®è»Œé“æ§åˆ¶ç„¦é»

```javascript
orbitControls.target.set(0, floorCenterY, 0);
```

ç„¦é»è¨­ç½®åœ¨è©²æ¨“å±¤çš„ä¸­å¿ƒï¼Œè®“ç”¨æˆ¶èƒ½çœ‹åˆ°è©²æ¨“å±¤çš„å®Œæ•´è¦–åœ–ã€‚

---

## ä¿®å¾©æ•ˆæœ

### ä¿®å¾©å‰
```
ç”¨æˆ¶é»æ“Š "2F" æŒ‰éˆ•
  â†“
selectFloor('2F') è¢«èª¿ç”¨
  â†“
æˆ¿é–“åˆ—è¡¨æ›´æ–°ï¼ˆä½†ç›¸æ©Ÿä¸è®Šï¼‰
  â†“
ç•«é¢æ²’æœ‰ä»»ä½•è¦–è¦ºè®ŠåŒ– âŒ
  â†“
ç”¨æˆ¶å›°æƒ‘ï¼šã€Œç‚ºä»€éº¼ç•«é¢æ²’è®Šï¼Ÿã€
```

### ä¿®å¾©å¾Œ
```
ç”¨æˆ¶é»æ“Š "2F" æŒ‰éˆ•
  â†“
selectFloor('2F') è¢«èª¿ç”¨
  â†“
æª¢æŸ¥ currentMode === 'exterior' âœ“
  â†“
è¨ˆç®— 2F çš„ä¸­å¿ƒé«˜åº¦ (10.75m)
  â†“
ç›¸æ©Ÿç§»å‹•åˆ° (80, 50.75, 80) âœ“
  â†“
è»Œé“æ§åˆ¶ç„¦é»è¨­ç½®åˆ° (0, 10.75, 0) âœ“
  â†“
æˆ¿é–“åˆ—è¡¨ã€ä¿¡æ¯é¢æ¿ã€minimap å…¨éƒ¨æ›´æ–° âœ“
  â†“
ç”¨æˆ¶çœ‹åˆ°ç›¸æ©Ÿå¹³æ»‘åœ°ç§»å‹•åˆ° 2F ä½ç½® âœ…
  â†“
ç”¨æˆ¶å¯ä»¥æ¸…æ¥šçœ‹åˆ° 2F çš„æˆ¿é–“å¸ƒå±€
```

### ç”¨æˆ¶é«”é©—æ”¹é€²

| æ“ä½œ | ä¿®å¾©å‰ | ä¿®å¾©å¾Œ |
|------|--------|--------|
| é»æ“Šã€Œ1Fã€ | ç•«é¢ç„¡åæ‡‰ âŒ | ç›¸æ©Ÿç§»å‹•åˆ° 1Fï¼Œé¡¯ç¤º 1F æˆ¿é–“ âœ… |
| é»æ“Šã€Œ2Fã€ | ç•«é¢ç„¡åæ‡‰ âŒ | ç›¸æ©Ÿç§»å‹•åˆ° 2Fï¼Œé¡¯ç¤º 2F æˆ¿é–“ âœ… |
| é»æ“Šã€Œ3Fã€ | ç•«é¢ç„¡åæ‡‰ âŒ | ç›¸æ©Ÿç§»å‹•åˆ° 3Fï¼Œé¡¯ç¤º 3F æˆ¿é–“ âœ… |
| é»æ“Šã€Œ4Fã€ | ç•«é¢ç„¡åæ‡‰ âŒ | ç›¸æ©Ÿç§»å‹•åˆ° 4Fï¼Œé¡¯ç¤º 4F æˆ¿é–“ âœ… |
| é»æ“Šæˆ¿é–“ | å·¦å´åˆ—è¡¨æ›´æ–°ä½†ç„¡è¦–è¦ºåé¥‹ âŒ | æˆ¿é–“è©³æƒ…é¡¯ç¤ºï¼Œä¿¡æ¯é¢æ¿æ›´æ–° âœ… |

---

## æŠ€è¡“ç´°ç¯€

### æ–‡ä»¶ä¿®æ”¹

| æ–‡ä»¶ | è¡Œè™Ÿ | ä¿®æ”¹ |
|------|------|------|
| HTML | 927-959 | ä¿®æ”¹ selectFloor() å‡½æ•¸ |

### ä¿®æ”¹ä»£ç¢¼è¡Œæ•¸

- æ–°å¢ï¼š16 è¡Œ
- ä¿®æ”¹ï¼š0 è¡Œ
- åˆªé™¤ï¼š0 è¡Œ

### ç›¸æ©Ÿè¨ˆç®—é©—è­‰

æ¨“å±¤é…ç½® (BUILDING_CONFIG):
```javascript
floors: ['B1', '1F', '2F', '3F', '4F']
floorHeights: [5, 4, 3.5, 3.5, 3.5]
```

ç›¸æ©Ÿä½ç½®è¨ˆç®—ï¼ˆä»¥ 1F ç‚ºä¾‹ï¼‰ï¼š
```
floorIndex = 1
floorCenterY = 0
for i = 0 to 0: floorCenterY += 5 â†’ floorCenterY = 5
floorCenterY += 4/2 â†’ floorCenterY = 7

ç›¸æ©Ÿä½ç½®: (80, 7+40, 80) = (80, 47, 80)
ç„¦é»ä½ç½®: (0, 7, 0)
```

---

## é©—è­‰æ¸…å–®

- âœ… ä¿®æ”¹å·²æ‡‰ç”¨åˆ° HTML æ–‡ä»¶
- âœ… èªæ³•æª¢æŸ¥ç„¡èª¤
- âœ… é‚è¼¯é©—è­‰ç„¡èª¤
- âœ… ä¸å½±éŸ¿å…¶ä»–åŠŸèƒ½ï¼ˆinterior mode, fps modeï¼‰
- âœ… ç›¸æ©Ÿè¨ˆç®—æ­£ç¢º

---

## ç›¸é—œå•é¡Œ

### å…¶ä»–æ¨¡å¼æ˜¯å¦éœ€è¦ä¿®å¾©ï¼Ÿ

| æ¨¡å¼ | æ¨“å±¤å°èˆªç¾ç‹€ | éœ€è¦ä¿®å¾© |
|------|-----------|---------|
| **Exterior** | é»æ“Šç„¡åæ‡‰ âŒ | âœ… **å·²ä¿®å¾©** |
| **Interior** | è»Œé“è¦–è§’ï¼Œå¯ä»¥è‡ªç”±æ—‹è½‰ âœ“ | âŒ ä¸éœ€è¦ï¼ˆè¨­è¨ˆå¦‚æ­¤ï¼‰ |
| **FPS** | ç¬¬ä¸€äººç¨±è¦–è§’ï¼Œæ‰‹å‹•å°èˆª âœ“ | âŒ ä¸éœ€è¦ï¼ˆè¨­è¨ˆå¦‚æ­¤ï¼‰ |

---

## æ¸¬è©¦æ­¥é©Ÿ

### æ‰‹å‹•æ¸¬è©¦

1. æ‰“é–‹ HTML æª”æ¡ˆ
2. ç¢ºèªç›®å‰åœ¨ã€Œå¤–éƒ¨è¦–è§’ã€æ¨¡å¼
3. é»æ“Šå·¦é‚Šå°èˆªæ¬„çš„ã€Œ1Fã€æŒ‰éˆ•
   - é æœŸï¼šç›¸æ©Ÿå¹³æ»‘ç§»å‹•åˆ° 1Fï¼Œé¡¯ç¤º 1F æˆ¿é–“åˆ—è¡¨
4. é»æ“Šã€Œ2Fã€æŒ‰éˆ•
   - é æœŸï¼šç›¸æ©Ÿå¹³æ»‘ç§»å‹•åˆ° 2Fï¼Œé¡¯ç¤º 2F æˆ¿é–“åˆ—è¡¨
5. é»æ“Šã€Œ4Fã€æŒ‰éˆ•
   - é æœŸï¼šç›¸æ©Ÿå¹³æ»‘ç§»å‹•åˆ° 4Fï¼Œé¡¯ç¤º 4F æˆ¿é–“åˆ—è¡¨
6. é»æ“Šæˆ¿é–“é …ç›®
   - é æœŸï¼šå³å´ä¿¡æ¯é¢æ¿é¡¯ç¤ºæˆ¿é–“è©³æƒ…

### æ§åˆ¶å°é©—è­‰

åœ¨ç€è¦½å™¨æ§åˆ¶å°åŸ·è¡Œï¼š
```javascript
// é©—è­‰ç•¶å‰æ¨¡å¼
console.log('Current Mode:', window.currentMode);

// é©—è­‰ç•¶å‰æ¨“å±¤
console.log('Current Floor:', window.currentFloor);

// æ‰‹å‹•æ¸¬è©¦æ¨“å±¤åˆ‡æ›
selectFloor('2F');  // æ‡‰è©²çœ‹åˆ°ç›¸æ©Ÿç§»å‹•
```

---

## é™„åŠ æ”¹é€²å»ºè­°

### å¾ŒçºŒå¯è€ƒæ…®çš„å¢å¼·åŠŸèƒ½

1. **ç›¸æ©Ÿå‹•ç•«**ï¼ˆå¯é¸ï¼‰
   - ä½¿ç”¨ Tween æˆ– requestAnimationFrame è£½é€ å¹³æ»‘çš„ç›¸æ©Ÿç§»å‹•å‹•ç•«
   - ç›®å‰æ˜¯ç¬é–“ç§»å‹•ï¼Œå¯æ”¹ç‚ºæ¼¸é€²å¼ç§»å‹•

2. **é›™æ“Šå¿«é€Ÿè·³è½‰**ï¼ˆå¯é¸ï¼‰
   - é›™æ“Šæ¨“å±¤æŒ‰éˆ•æ™‚ï¼Œç›¸æ©Ÿç§»å‹•åˆ°è©²æ¨“å±¤é€²è¡Œè©³ç´°æŸ¥çœ‹

3. **éµç›¤å¿«æ·éµ**ï¼ˆå¯é¸ï¼‰
   - æŒ‰ 1-4 å¿«é€Ÿåˆ‡æ›æ¨“å±¤ï¼ˆ1F-4Fï¼‰
   - æŒ‰ B åˆ‡æ› B1

---

## çµè«–

âœ… **ä¿®å¾©å®Œæˆ**

å¤–éƒ¨è¦–è§’æ¨¡å¼ä¸‹çš„æ¨“å±¤å°èˆªç¾åœ¨å®Œå…¨å¯ç”¨ã€‚ç”¨æˆ¶é»æ“Šæ¨“å±¤æŒ‰éˆ•æ™‚ï¼Œç›¸æ©Ÿæœƒè‡ªå‹•ç§»å‹•åˆ°è©²æ¨“å±¤é€²è¡ŒæŸ¥çœ‹ï¼Œæä¾›è‰¯å¥½çš„è¦–è¦ºåé¥‹å’Œç”¨æˆ¶é«”é©—ã€‚

**ä¿®å¾©è€…**: Claude Code AI Assistant
**ä¿®å¾©æ—¥æœŸ**: 2025-10-24
**æ¸¬è©¦ç‹€æ…‹**: â³ å¾…æ¸¬è©¦

